{% extends "base.html" %}

{% block title %}My Price Alerts{% endblock %}

{% block content %}
<div class="container my-4">
    <h2 class="mb-4"><i class="fas fa-bell"></i> My Price Alerts</h2>

    <div class="alert alert-warning">
        <i class="fas fa-bolt"></i> <strong>Trigger Demo:</strong> The 'Status' of these alerts
        is updated automatically by the <code>trigger_price_alert</code> trigger
        when inventory prices change.
    </div>

    <div class="card">
        <div class="card-body">
            {% if alerts %}
            <div class="table-responsive">
                <table class="table table-hover align-middle">
    <thead>
        <tr>
            <th>Product</th>
            <th>Store</th>
            <th>Target Price</th>
            <th>Current Price</th>
            <th>Status</th>
            <th>Date Set</th>
            <th>Action</th> </tr>
    </thead>
    <tbody>
        {% for alert in alerts %}
        <tr>
            <td>
                <a href="{{ url_for('customer_product_detail', product_id=alert.product_id) }}">
                    <strong>{{ alert.product_name }}</strong>
                </a>
                <br><small class="text-muted">{{ alert.brand }}</small>
            </td>
            <td>{{ alert.store_name }}</td>
            <td><span class="text-danger">₹{{ "%.2f"|format(alert.target_price) }}</span></td>
            <td><strong class="text-success">₹{{ "%.2f"|format(alert.current_price) }}</strong></td>
            <td>
                {% if alert.status == 'active' %}
                <span class="badge bg-secondary">Active</span>
                {% elif alert.status == 'triggered' %}
                <span class="badge bg-success">Triggered!</span>
                {% else %}
                <span class="badge bg-light text-dark">{{ alert.status }}</span>
                {% endif %}
            </td>
            <td>{{ alert.alert_date.strftime('%Y-%m-%d') }}</td>
            
            <td>
                <a href="{{ url_for('delete_alert', alert_id=alert.alert_id) }}" 
                   class="btn btn-sm btn-outline-danger" 
                   onclick="return confirm('Are you sure you want to delete this alert?')">
                    <i class="fas fa-trash"></i>
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
            </div>
            {% else %}
            <p class="text-muted text-center mb-0">You have not set any price alerts.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}